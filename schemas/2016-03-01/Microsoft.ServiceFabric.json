{
  "id": "http://schema.management.azure.com/schemas/2016-03-01/Microsoft.ServiceFabric.json#",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Microsoft.ServiceFabric",
  "description": "Microsoft ServiceFabric Resource Types",
  "resourceDefinitions": {
    "clusters": {
      "type": "object",
      "properties": {
        "type": {
          "enum": [
            "Microsoft.ServiceFabric/clusters"
          ]
        },
        "apiVersion": {
          "enum": [
            "2016-03-01"
          ]
        },
        "properties": {
          "type": "object",
          "properties": {
            "VMImage": {
              "type": "string",
              "description": "Microsoft.ServiceFabric/clusters: The name of VM image VMSS has been configured with. Generic names such as Windows or Linux can be used."
            },
            "HttpApplicationGatewayCertificate": {
              "oneOf": [
                {
                  "$ref": "#/definitions/CertificateDescription"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: The server certificate used by http application gateway."
            },
            "AzureActiveDirectory": {
              "oneOf": [
                {
                  "$ref": "#/definitions/AzureActiveDirectory"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: The settings to enable AAD authentication on the cluster."
            },
            "ReliabilityLevel": {
              "oneOf": [
                {
                  "enum": [
                    "Invalid",
                    "Bronze",
                    "Silver",
                    "Gold",
                    "Platinum"
                  ]
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: This level is used to set the number of replicas of the system services. Details: http://azure.microsoft.com/en-us/documentation/articles/service-fabric-cluster-capacity/#the-reliability-characteristics-of-the-cluster"
            },
            "NodeTypes": {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/NodeTypes"
                  },
                  "minItems": 1                  
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],              
              "description": "Microsoft.ServiceFabric/clusters: The node types of the cluster. Details: http://azure.microsoft.com/en-us/documentation/articles/service-fabric-cluster-capacity"
            },
            "ManagementEndpoint": {
              "type": "string",
              "minLength": 1,
              "description": "Microsoft.ServiceFabric/clusters: The http management endpoint of the cluster."
            },
            "Certificate": {
              "oneOf": [
                {
                  "$ref": "#/definitions/CertificateDescription"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: The certificate to use for node to node communication within cluster, the server certificate of the cluster and the default admin client."
            },
            "ClientCertificateThumbprints": {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/ClientCertificateThumbprint"
                  }
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: List of client certificates to whitelist based on thumbprints."
            },
            "ClientCertificateCommonNames": {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/ClientCertificateCommonName"
                  }
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: List of client certificates to whitelist based on common names."
            },
            "FabricSettings": {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/SettingsSectionDescription"
                  }
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: List of custom fabric settings to configure the cluster."
            },
            "UpgradeDescription": {
              "oneOf": [
                {
                  "$ref": "#/definitions/PaasClusterUpgradePolicy"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: The policy to use when upgrading the cluster."
            },
            "DiagnosticsStorageAccountConfig": {
              "oneOf": [
                {
                  "$ref": "#/definitions/DiagnosticsStorageAccountConfig"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ],
              "description": "Microsoft.ServiceFabric/clusters: The azure storage account information for uploading cluster logs."
            }
          }          
        }
      },
      "required": [
        "type",
        "apiVersion",
        "properties"
      ],
      "description": "Microsoft.ServiceFabric/clusters: ServiceFabric cluster resource."
    }
  },
  "definitions": {
    "CertificateDescription": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "Thumbprint": {
              "type": "string",
              "minLength": 1
            },
            "ThumbprintSecondary": {
              "type": "string"
            },
            "X509StoreName": {
              "oneOf": [
                {
                  "enum": [
                    "AddressBook",
                    "AuthRoot",
                    "CertificateAuthority",
                    "Disallowed",
                    "My",
                    "Root",
                    "TrustedPeople",
                    "TrustedPublisher"
                  ]
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            }
          },
          "required": [
            "Thumbprint",
            "X509StoreName"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ],
      "description": "Microsoft.ServiceFabric/clusters/HttpApplicationGatewayCertificate - CertificateDescription"
    },
    "AzureActiveDirectory": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "TenantId": {
              "type": "string",
              "minLength": 1
            },
            "ClusterApplication": {
              "type": "string",
              "minLength": 1
            },
            "ClientApplication": {
              "type": "string",
              "minLength": 1
            }
          },
          "required": [
            "TenantId",
            "ClusterApplication",
            "ClientApplication"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ],
      "description": "Microsoft.ServiceFabric/clusters/AzureActiveDirectory - AzureActiveDirectory"
    },
    "NodeTypes": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "HttpApplicationGatewayEndpointPort": {
              "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
            },
            "DurabilityLevel": {
              "enum": [
                "Bronze",
                "Silver",
                "Gold",
                "Platinum"
              ]
            },
            "VMInstanceCount": {
              "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression",
              "minimum": 1,
              "maximum": 2147483647
            },
            "Name": {
              "type": "string",
              "minLength": 1
            },
            "PlacementProperties": {
              "oneOf": [
                {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "Capacities": {
              "oneOf": [
                {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "ClientConnectionEndpointPort": {
              "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
            },
            "HttpGatewayEndpointPort": {
              "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
            },
            "ApplicationPorts": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "StartPort": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    },
                    "EndPort": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    }
                  },
                  "required": [
                    "StartPort",
                    "EndPort"
                  ]
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "EphemeralPorts": {
              "$ref": "#/definitions/NodeTypes/oneOf/0/properties/ApplicationPorts"
            },
            "IsPrimary": {
              "oneOf": [
                {
                  "type": "boolean"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            }
          },
          "required": [
            "VMInstanceCount",
            "Name",
            "ClientConnectionEndpointPort",
            "HttpGatewayEndpointPort",
            "IsPrimary"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ]
    },
    "EndpointRangeDescription": {
      "$ref": "#/definitions/NodeTypes/oneOf/0/properties/ApplicationPorts"
    },
    "ClientCertificateThumbprint": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "IsAdmin": {
              "oneOf": [
                {
                  "type": "boolean"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "CertificateThumbprint": {
              "type": "string",
              "minLength": 1
            }
          },
          "required": [
            "IsAdmin",
            "CertificateThumbprint"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ]
    },
    "ClientCertificateCommonName": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "IsAdmin": {
              "oneOf": [
                {
                  "type": "boolean"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "CertificateCommonName": {
              "type": "string",
              "minLength": 1
            },
            "CertificateIssuerThumbprint": {
              "type": "string",
              "minLength": 1
            }
          },
          "required": [
            "IsAdmin",
            "CertificateCommonName",
            "CertificateIssuerThumbprint"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ]
    },
    "SettingsSectionDescription": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "Name": {
              "type": "string",
              "minLength": 1
            },
            "Parameters": {
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "type": "object",
                    "properties": {
                      "Name": {
                        "type": "string",
                        "minLength": 1
                      },
                      "Value": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "Name",
                      "Value"
                    ]
                  },
                  {
                    "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                  }
                ]
              }
            }
          },
          "required": [
            "Name",
            "Parameters"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ]
    },
    "SettingsParameterDescription": {
      "$ref": "#/definitions/SettingsSectionDescription/oneOf/0/properties/Parameters/items/oneOf/0"
    },
    "PaasClusterUpgradePolicy": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "ForceRestart": {
              "oneOf": [
                {
                  "type": "boolean"
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "UpgradeReplicaSetCheckTimeout": {
              "type": "string"
            },
            "HealthCheckWaitDuration": {
              "type": "string"
            },
            "HealthCheckStableDuration": {
              "type": "string"
            },
            "HealthCheckRetryTimeout": {
              "type": "string"
            },
            "UpgradeTimeout": {
              "type": "string"
            },
            "UpgradeDomainTimeout": {
              "type": "string"
            },
            "HealthPolicy": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "MaxPercentUnhealthyNodes": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    },
                    "MaxPercentUnhealthyApplications": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    }
                  },
                  "required": [
                    "MaxPercentUnhealthyNodes",
                    "MaxPercentUnhealthyApplications"
                  ]
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            },
            "DeltaHealthPolicy": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "MaxPercentDeltaUnhealthyNodes": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    },
                    "MaxPercentUpgradeDomainDeltaUnhealthyNodes": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    },
                    "MaxPercentDeltaUnhealthyApplications": {
                      "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/numberOrExpression"
                    }
                  },
                  "required": [
                    "MaxPercentDeltaUnhealthyNodes",
                    "MaxPercentUpgradeDomainDeltaUnhealthyNodes",
                    "MaxPercentDeltaUnhealthyApplications"
                  ]
                },
                {
                  "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
                }
              ]
            }
          },
          "required": [
            "ForceRestart",
            "UpgradeReplicaSetCheckTimeout",
            "HealthCheckWaitDuration",
            "HealthCheckStableDuration",
            "HealthCheckRetryTimeout",
            "UpgradeTimeout",
            "UpgradeDomainTimeout",
            "HealthPolicy"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ],
      "description": "Microsoft.ServiceFabric/clusters/UpgradeDescription - PaasClusterUpgradePolicy"
    },
    "PaasClusterUpgradeHealthPolicy": {
      "$ref": "#/definitions/PaasClusterUpgradePolicy/oneOf/0/properties/HealthPolicy"
    },
    "PaasClusterUpgradeDeltaHealthPolicy": {
      "$ref": "#/definitions/PaasClusterUpgradePolicy/oneOf/0/properties/DeltaHealthPolicy"
    },
    "DiagnosticsStorageAccountConfig": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "StorageAccountName": {
              "type": "string",
              "minLength": 1
            },
            "ProtectedAccountKeyName": {
              "type": "string"
            },
            "BlobEndpoint": {
              "type": "string"
            },
            "QueueEndpoint": {
              "type": "string"
            },
            "TableEndpoint": {
              "type": "string"
            }
          },
          "required": [
            "StorageAccountName",
            "ProtectedAccountKeyName",
            "BlobEndpoint",
            "QueueEndpoint",
            "TableEndpoint"
          ]
        },
        {
          "$ref": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#/definitions/expression"
        }
      ],
      "description": "Microsoft.ServiceFabric/clusters/DiagnosticsStorageAccountConfig - DiagnosticsStorageAccountConfig"
    }
  }
}