{
  "tests": [
    {
      "name": "clusters - Missing properties",
      "definition": "http://schema.management.azure.com/schemas/2016-09-01/Microsoft.ServiceFabric.json#/resourceDefinitions/clusters",
      "json": {
        "type": "Microsoft.ServiceFabric/clusters",
        "apiVersion": "2016-09-01",
        "location": "West Us",
        "properties": {}
      },
      "expectedErrors": [
        {
          "message": "Missing required property: managementEndpoint",
          "dataPath": "/"
        },
        {
          "message": "Missing required property: nodeTypes",
          "dataPath": "/"
        }
      ]
    },
    {
      "name": "clusters - Many properties",
      "definition": "http://schema.management.azure.com/schemas/2016-09-01/Microsoft.ServiceFabric.json#/resourceDefinitions/clusters",
      "json": {
        "type": "Microsoft.ServiceFabric/clusters",
        "apiVersion": "2016-09-01",
        "location": "West Us",
        "properties": {
          "upgradeMode": "Manual",
          "clusterCodeVersion": "5.0.0.0",
          "certificate": {
            "thumbprint": "[parameters('certificateThumbprint')]",
            "x509StoreName": "[parameters('certificateStoreValue')]"
          },
          "clientCertificateCommonNames": [
            {
              "isAdmin": "false",
              "certificateCommonName": "randomCommonName",
              "certificateIssuerThumbprint": "randomIssuerThumprintValue"
            }
          ],
          "clientCertificateThumbprints": [
            {
              "isAdmin": "false",
              "CertificateThumbprint": "randomThumprintValue"
            }
          ],
          "diagnosticsStorageAccountConfig": {
            "blobEndpoint": "[reference(concat('Microsoft.Storage/storageAccounts/', variables('supportLogStorageAccountName')), variables('storageApiVersion')).primaryEndpoints.blob]",
            "protectedAccountKeyName": "StorageAccountKey1",
            "queueEndpoint": "[reference(concat('Microsoft.Storage/storageAccounts/', variables('supportLogStorageAccountName')), variables('storageApiVersion')).primaryEndpoints.queue]",
            "storageAccountName": "[variables('supportLogStorageAccountName')]",
            "tableEndpoint": "[reference(concat('Microsoft.Storage/storageAccounts/', variables('supportLogStorageAccountName')), variables('storageApiVersion')).primaryEndpoints.table]"
          },
          "fabricSettings": [
            {
              "parameters": [
                {
                  "name": "ClusterProtectionLevel",
                  "value": "[parameters('clusterProtectionLevel')]"
                }
              ],
              "name": "Security"
            }
          ],
          "managementEndpoint": "[concat('http://',reference(concat(variables('lbIPName'),'-','0')).dnsSettings.fqdn,':',variables('nt0fabricHttpGatewayPort'))]",
          "nodeTypes": [
            {
              "name": "[variables('vmNodeType0Name')]",
              "placementProperties": [
                {
                  "color": "blue"
                },
                {
                  "size": "large"
                }
              ],
              "capacities": [
                {
                  "color": "blue"
                },
                {
                  "size": "large"
                }
              ],
              "applicationPorts": {
                "endPort": "[variables('nt0applicationEndPort')]",
                "startPort": "[variables('nt0applicationStartPort')]"
              },
              "clientConnectionEndpointPort": "[variables('nt0fabricTcpGatewayPort')]",
              "durabilityLevel": "Bronze",
              "ephemeralPorts": {
                "endPort": "[variables('nt0ephemeralEndPort')]",
                "startPort": "[variables('nt0ephemeralStartPort')]"
              },
              "httpGatewayEndpointPort": "[variables('nt0fabricHttpGatewayPort')]",
              "isPrimary": true,
              "vmInstanceCount": "[parameters('nt0InstanceCount')]",
              "reverseProxyEndpointPort": "9000"
            }
          ],
          "reliabilityLevel": "Silver",
          "vmImage": "Windows"
        }
      }
    },
    {
      "name": "clusters - Minimum properties",
      "definition": "http://schema.management.azure.com/schemas/2016-09-01/Microsoft.ServiceFabric.json#/resourceDefinitions/clusters",
      "json": {
        "type": "Microsoft.ServiceFabric/clusters",
        "apiVersion": "2016-09-01",
        "location": "West Us",
        "properties": {          
          "diagnosticsStorageAccountConfig": {
            "blobEndpoint": "[reference(concat('Microsoft.Storage/storageAccounts/', variables('supportLogStorageAccountName')), variables('storageApiVersion')).primaryEndpoints.blob]",
            "protectedAccountKeyName": "StorageAccountKey1",
            "queueEndpoint": "[reference(concat('Microsoft.Storage/storageAccounts/', variables('supportLogStorageAccountName')), variables('storageApiVersion')).primaryEndpoints.queue]",
            "storageAccountName": "[variables('supportLogStorageAccountName')]",
            "tableEndpoint": "[reference(concat('Microsoft.Storage/storageAccounts/', variables('supportLogStorageAccountName')), variables('storageApiVersion')).primaryEndpoints.table]"
          },          
          "managementEndpoint": "[concat('http://',reference(concat(variables('lbIPName'),'-','0')).dnsSettings.fqdn,':',variables('nt0fabricHttpGatewayPort'))]",
          "nodeTypes": [
            {
              "name": "[variables('vmNodeType0Name')]",
              "applicationPorts": {
                "endPort": "[variables('nt0applicationEndPort')]",
                "startPort": "[variables('nt0applicationStartPort')]"
              },
              "clientConnectionEndpointPort": "[variables('nt0fabricTcpGatewayPort')]",
              "durabilityLevel": "Bronze",
              "ephemeralPorts": {
                "endPort": "[variables('nt0ephemeralEndPort')]",
                "startPort": "[variables('nt0ephemeralStartPort')]"
              },
              "httpGatewayEndpointPort": "[variables('nt0fabricHttpGatewayPort')]",
              "isPrimary": true,
              "vmInstanceCount": "[parameters('nt0InstanceCount')]"
            }
          ]          
        }
      }
    },
        {
      "name": "clusters - Missing required property in node type",
      "definition": "http://schema.management.azure.com/schemas/2016-09-01/Microsoft.ServiceFabric.json#/resourceDefinitions/clusters",
      "json": {
        "type": "Microsoft.ServiceFabric/clusters",
        "apiVersion": "2016-09-01",
        "location": "West Us",
        "properties": {          
          "diagnosticsStorageAccountConfig": {
            "blobEndpoint": "RandomEndpoint",
            "protectedAccountKeyName": "StorageAccountKey1",
            "queueEndpoint": "RandomEndpoint",
            "storageAccountName": "RandomAccountName",
            "tableEndpoint": "RandomEndpoint"
          },          
          "managementEndpoint": "RandomManagementEndpoint",
          "nodeTypes": [
            {              
              "applicationPorts": {
                "endPort": "10000",
                "startPort": "20000"
              },
              "clientConnectionEndpointPort": "[variables('nt0fabricTcpGatewayPort')]",
              "durabilityLevel": "Bronze",
              "ephemeralPorts": {
                "endPort": "30000",
                "startPort": "40000"
              },
              "httpGatewayEndpointPort": "19080",
              "isPrimary": true,
              "vmInstanceCount": "5"
            }
          ]          
        }
      },      
      "expectedErrors": [
        {
          "message": "Missing required property: name",
          "dataPath": "/"
        }
      ]
    }
  ]
}