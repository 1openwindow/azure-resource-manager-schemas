{
  "tests": [
    {
      "name": "IotHubs - full",
      "definition": "http://schema.management.azure.com/schemas/2016-02-03/Microsoft.Devices.json#/resourceDefinitions/IotHubs",
      "json": {
        "type": "Microsoft.Devices/IotHubs",
        "apiVersion": "2016-02-03",
        "location": "West Us",
        "resourcegroup": "testRG",
        "subscriptionId": "sub1",
        "sku": {
          "name": "F1",
	  "capacity": 100
	},
        "properties": {
	  "authorizationPolicies": [
	    { 
	      "keyName": "IotHubAllAccessSasKey",
	      "primaryKey": "CQN2K33r45/0WeIjpqmErV5EIvX8JZrozt3NEHCEkG8=",
              "secondaryKey": "RpkT42rNZl4/J08pI8tnsE2mPbsbuQ//+9x3HSs0XcU=",
              "rights": "RegistryWrite"
            }
          ],
          "eventHubEndpoints": {
	    "events": {
	      "retentionTimeInDays": 2,
              "partitionCount": 2
            }
          },
          "storageEndpoints": {
	    "fileUploadEndpoint": {
              "sasTtlAsIso8601": "PT1H",
              "connectionString": "AAAAABAAu3eNkJ1GCwvVE6R87dIugyAAFxdSay61We3kBRSLZ/hgRoN37m87pjKd0UWhcZeibPvQADy9fyaS7xOMG655Xs6oU0sfIJcmfIfBKEueMpnzmoF4AV9S0YKXKSKB0kA2/rg4ds2IEbjzvq2ut8phMD+O0JQRwAB1MaU73NF8WVfpvWAsrhrgXTet8Xzdm7+p9p5w2YfFgz/Hiq4kLeSI2XH+SCIE341Atm/pR5VimTuEvngnmkq+2P2d+Svn5fgS9Xx16KDKHYqbg4bE2ea9gkSt0kAHimeeAUtwZt/oey1bDo9L2uzi58YFIeawYgo7YDLoyv4nah+MBqsfkYUISv02lLM=",
              "containerName": "fileuploadContainer"
	    }
          },
	  "enableFileUploadNotifications": true,
          "cloudToDevice": {
	    "maxDeliveryCount": 2,
	    "defaultTtlAsIso8601": "PT1H",
	    "feedback": {
	      "lockDurationAsIso8601": "PT1M",
	      "ttlAsIso8601": "PT1H",
	      "maxDeliveryCount": 20
	    }
          },
	  "features": "DeviceManagement"
        }
      }
    },
    {
      "name": "IotHubs - Out of range test for cloudToDevice > maxDeliverCount",
      "expectedErrors": [
        {
          "message": "Data does not match any schemas from \"oneOf\"",
          "dataPath": "/properties",
          "schemaPath": "/properties/properties/oneOf",
          "subErrors":     [
            {
              "message": "Data does not match any schemas from \"oneOf\"",
              "dataPath": "/properties/cloudToDevice",
              "schemaPath": "/properties/properties/oneOf/0/properties/cloudToDevice/oneOf",
              "subErrors":         [
                {
                  "message": "Data does not match any schemas from \"oneOf\"",
                  "dataPath": "/properties/cloudToDevice/maxDeliveryCount",
                  "schemaPath": "/properties/properties/oneOf/0/properties/cloudToDevice/oneOf/0/properties/maxDeliveryCount/oneOf",
                  "subErrors":             [
                    {
                      "message": "Value 300 is greater than maximum 100",
                      "dataPath": "/properties/cloudToDevice/maxDeliveryCount",
                      "schemaPath": "/properties/properties/oneOf/0/properties/cloudToDevice/oneOf/0/properties/maxDeliveryCount/oneOf/0/maximum"
                    },
                    {
                      "message": "Invalid type: number (expected string)",
                      "dataPath": "/properties/cloudToDevice/maxDeliveryCount",
                      "schemaPath": "/properties/properties/oneOf/0/properties/cloudToDevice/oneOf/0/properties/maxDeliveryCount/oneOf/1/type"
                    }
                  ]
                },
                {
                  "message": "Invalid type: object (expected string)",
                  "dataPath": "/properties/cloudToDevice",
                  "schemaPath": "/properties/properties/oneOf/0/properties/cloudToDevice/oneOf/1/type"
                }
              ]
            },
            {
              "message": "Invalid type: object (expected string)",
              "dataPath": "/properties",
              "schemaPath": "/properties/properties/oneOf/1/type"
            }
          ]
        }
      ],
      "definition": "http://schema.management.azure.com/schemas/2016-02-03/Microsoft.Devices.json#/resourceDefinitions/IotHubs",
      "json": {
        "type": "Microsoft.Devices/IotHubs",
        "apiVersion": "2016-02-03",
        "location": "West Us",
        "resourcegroup": "testRG",
        "subscriptionId": "sub1",
        "sku": {
          "name": "F1",
	  "capacity": 100
	},
        "properties": {
	  "authorizationPolicies": [
	    { 
	      "keyName": "IotHubAllAccessSasKey",
	      "primaryKey": "CQN2K33r45/0WeIjpqmErV5EIvX8JZrozt3NEHCEkG8=",
              "secondaryKey": "RpkT42rNZl4/J08pI8tnsE2mPbsbuQ//+9x3HSs0XcU=",
              "rights": "RegistryWrite"
            }
          ],
          "eventHubEndpoints": {
	    "events": {
	      "retentionTimeInDays": 2,
              "partitionCount": 2
            }
          },
          "storageEndpoints": {
	    "fileUploadEndpoint": {
              "sasTtlAsIso8601": "PT1H",
              "connectionString": "AAAAABAAu3eNkJ1GCwvVE6R87dIugyAAFxdSay61We3kBRSLZ/hgRoN37m87pjKd0UWhcZeibPvQADy9fyaS7xOMG655Xs6oU0sfIJcmfIfBKEueMpnzmoF4AV9S0YKXKSKB0kA2/rg4ds2IEbjzvq2ut8phMD+O0JQRwAB1MaU73NF8WVfpvWAsrhrgXTet8Xzdm7+p9p5w2YfFgz/Hiq4kLeSI2XH+SCIE341Atm/pR5VimTuEvngnmkq+2P2d+Svn5fgS9Xx16KDKHYqbg4bE2ea9gkSt0kAHimeeAUtwZt/oey1bDo9L2uzi58YFIeawYgo7YDLoyv4nah+MBqsfkYUISv02lLM=",
              "containerName": "fileuploadContainer"
	    }
          },
	  "enableFileUploadNotifications": true,
          "cloudToDevice": {
	    "maxDeliveryCount": 300,
	    "defaultTtlAsIso8601": "PT1H",
	    "feedback": {
	      "lockDurationAsIso8601": "PT1M",
	      "ttlAsIso8601": "PT1H",
	      "maxDeliveryCount": 20
	    }
          },
	  "features": "DeviceManagement"
        }
      }
    },
    {
      "name": "IotHubs - Out of range test for cloudToDevice > feedback > maxDeliverCount",
      "expectedErrors": [

      ],
      "definition": "http://schema.management.azure.com/schemas/2016-02-03/Microsoft.Devices.json#/resourceDefinitions/IotHubs",
      "json": {
        "type": "Microsoft.Devices/IotHubs",
        "apiVersion": "2016-02-03",
        "location": "West Us",
        "resourcegroup": "testRG",
        "subscriptionId": "sub1",
        "sku": {
          "name": "F1",
	  "capacity": 100
	},
        "properties": {
	  "authorizationPolicies": [
	    { 
	      "keyName": "IotHubAllAccessSasKey",
	      "primaryKey": "CQN2K33r45/0WeIjpqmErV5EIvX8JZrozt3NEHCEkG8=",
              "secondaryKey": "RpkT42rNZl4/J08pI8tnsE2mPbsbuQ//+9x3HSs0XcU=",
              "rights": "RegistryWrite"
            }
          ],
          "eventHubEndpoints": {
	    "events": {
	      "retentionTimeInDays": 2,
              "partitionCount": 2
            }
          },
          "storageEndpoints": {
	    "fileUploadEndpoint": {
              "sasTtlAsIso8601": "PT1H",
              "connectionString": "AAAAABAAu3eNkJ1GCwvVE6R87dIugyAAFxdSay61We3kBRSLZ/hgRoN37m87pjKd0UWhcZeibPvQADy9fyaS7xOMG655Xs6oU0sfIJcmfIfBKEueMpnzmoF4AV9S0YKXKSKB0kA2/rg4ds2IEbjzvq2ut8phMD+O0JQRwAB1MaU73NF8WVfpvWAsrhrgXTet8Xzdm7+p9p5w2YfFgz/Hiq4kLeSI2XH+SCIE341Atm/pR5VimTuEvngnmkq+2P2d+Svn5fgS9Xx16KDKHYqbg4bE2ea9gkSt0kAHimeeAUtwZt/oey1bDo9L2uzi58YFIeawYgo7YDLoyv4nah+MBqsfkYUISv02lLM=",
              "containerName": "fileuploadContainer"
	    }
          },
	  "enableFileUploadNotifications": true,
          "cloudToDevice": {
	    "maxDeliveryCount": 30,
	    "defaultTtlAsIso8601": "PT1H",
	    "feedback": {
	      "lockDurationAsIso8601": "PT1M",
	      "ttlAsIso8601": "PT1H",
	      "maxDeliveryCount": 300
	    }
          },
	  "features": "DeviceManagement"
        }
      }
    }
  ]
}